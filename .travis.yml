language: smalltalk
sudo: false

os:
  - linux

smalltalk:
  - Pharo-7.0

# Unit tests run the normal pillar tests
# Integration tests test that pillar itself can interact with generated files, pdf generation, etc.
# System tests test that we can install and use pillar as a black box

install:
  # Pillar installation
  - git clone https://github.com/pillar-markup/pillar.git -b v7.4.1 
  - cd pillar && ./scripts/build.sh && cd ..                      
  - . pillar/scripts/ci/ensure_latex.sh                                   
  - ./pillar/scripts/ci/ensure_book_dependencies.sh                       
  
script:
  - ./pillar/build/pillar build pdf

after_success:
  - wget -c https://github.com/probonopd/uploadtool/raw/master/upload.sh
  - mv _result/pdf/index.pdf pbe8-wip.pdf
  - bash upload.sh pbe8-wip.pdf

branches:
  except:
    - /^(?i:continuous)$/
